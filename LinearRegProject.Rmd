---
title: "LinearRegProject"
author: "Nan Zhang, Lichun He, Yuqi Zhang"
date: "11/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Should This Loan be Approved or Denied?

## Setup
```{r}
# Setup
library(lubridate)
library(tidyverse)
library(broom)

SBAnational_raw <- read.csv(file = "SBAnational.csv", header = T)
SBAnational_raw <- na.omit(SBAnational_raw)
#head(SBA_NY_raw, 5)
#apply(is.na(SBA_NY_raw), 2, sum)
```
## Section 1: Pre-Process

### Section 1.1: Data Cleaning
```{r}
# Choose the data after 2000
# Choose the data in NY
SBA_NY <- SBAnational_raw %>% 
  mutate(DisbursementDate = dmy(DisbursementDate)) %>% 
  filter( LowDoc %in% c("Y", "N"), year(DisbursementDate) >= 2000, State =="NY")

# Remove the 0's in NAICS
SBA_NY$NAICS[SBA_NY$NAICS==0] <- NA
SBA_NY <- SBA_NY[!is.na(SBA_NY$NAICS), ]

# Remove empty string 
SBA_NY <- SBA_NY[SBA_NY$MIS_Status != "",]

#apply(is.na(SBA_NY), 2, sum)
nrow(SBA_NY)
```

### Section 1.2: Values Replacing
```{r}
# Only keep the first two number
SBA_NY$NAICS <- as.numeric(substr(as.character(SBA_NY$NAICS), 
                                       start = 1, stop = 2))

# Change string to number
rmSym <- function(string){
  string <- substr(string, start = 2, stop = nchar(string))
  return(string)
}
SBA_NY$DisbursementGross <- 
  as.numeric(gsub(",","", rmSym(SBA_NY$DisbursementGross)))
SBA_NY$BalanceGross <- 
  as.numeric(gsub(",","", rmSym(SBA_NY$BalanceGross)))
SBA_NY$GrAppv <- as.numeric(gsub(",","", rmSym(SBA_NY$GrAppv)))
SBA_NY$SBA_Appv <- as.numeric(gsub(",","", rmSym(SBA_NY$SBA_Appv)))

head(SBA_NY, 5)
#apply(is.na(SBA_NY), 2, sum)
```

### Section 1.3: Data Re-format/Transformation
```{r}

```

## Section 2: Explore the Variables

### Section 2.1: Each industry default rate v.s NAICS
```{r}
SBA_NY_NAICS <- SBA_NY %>%
  mutate(Industy_code = as.numeric(substr(as.character(SBA_NY$NAICS), 
                                       start = 1, stop = 2))) %>%
  group_by(Industy_code) %>%
  summarize(CHGOFF = sum(MIS_Status =="CHGOFF"),
            PIF = sum(MIS_Status =="P I F"), 
            default_rate = CHGOFF /(CHGOFF + PIF))
SBA_NY_NAICS
plot(x = SBA_NY_NAICS$Industy_code, y = SBA_NY_NAICS$default_rate, 
     main = "the default rate of each industry", 
     xlab = "Industy", ylab = "default rate")
```

From the graphs, we can see that the default rates are different in each industry, so we take NAICS into our consideration

### Section 2.2: Y v.s X2 ...
```{r}

```

### Section 2.3: Y v.s X3 ...
```{r}

```

## Section 3: Fit Linear Model

### Section 3.1: Split Training-Testing data
```{r}
## 50% of the sample size
sample_size <- floor(0.5 * nrow(SBA_NY))

## set the seed to make partition reproducible
set.seed(123)
train_index <- sample(seq_len(nrow(SBA_NY)), size = sample_size)

SBA_train <- SBA_NY[train_index, ]
SBA_test <- SBA_NY[-train_index, ]
```

### Section 3.2: ...
```{r}

```

### Section 3.3: ...
```{r}

```

### Section 3.4: Summary
```{r}

```

## Section 4: Residuals

### Section 4.1: ...
```{r}

```

### Section 4.2: ...
```{r}

```

### Section 4.3: ...
```{r}

```

## Section 5: Testing/Validation

### Section 5.1: ...
```{r}

```

### Section 5.2: ...
```{r}

```

### Section 5.3: ...
```{r}

```

## Section 6: Prediction

### Section 6.1: ...
```{r}

```

### Section 6.2: ...
```{r}

```

### Section 6.3: ...
```{r}

```

## Section 7: Conclusion
